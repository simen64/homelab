FROM quay.io/fedora/fedora-bootc:42

#ARGS
ARG IP_ADDR
ARG GATEWAY
ARG DNS_SERVER
ARG HOSTNAME

# Set kernel arg for static ip
RUN echo "kargs = ['ip=${IP_ADDR}::${GATEWAY}:255.255.255.0:${HOSTNAME}:ens18:none:${DNS_SERVER}']" > /usr/lib/bootc/kargs.d/10-staticIP.toml

# install packages  
RUN dnf -y install qemu-guest-agent && dnf clean all

# Copy sshd config over
COPY resources/sshd_config /etc/ssh/

# Make data dir
RUN mkdir -p /var/lib/minio/data/

# Minio
COPY minio-caddy-bootc/minio.image /usr/share/containers/systemd/
COPY minio-caddy-bootc/minio.container /usr/share/containers/systemd/

COPY minio-caddy-bootc/minio.env /etc/
RUN chmod 600 /etc/minio.env

# Caddy
COPY minio-caddy-bootc/caddy.image /usr/share/containers/systemd/
COPY minio-caddy-bootc/caddy.container /usr/share/containers/systemd/

COPY minio-caddy-bootc/Caddyfile /etc/caddy/
